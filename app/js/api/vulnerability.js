'use strict';

const apiModule = require('./');

// const URI = require('urijs');

//TODO: take out when api is done
const find = require('lodash/find');

/**
 * @ngInject
 */
function Vulnerability ($q, VMAAS_CVES, VMAAS_PACKAGES_NOCVE) {

    // function Policy ($http, AccountService, InsightsConfig) {

    // const vulnerabilitiesUri = 'vulnerabilities';
    // const root = InsightsConfig.apiRoot;

    return {

        // getAll (params) {
        //     let url = URI(root);
        //     url.segment(vulnerabilitiesUri);
        //     url.addSearch(AccountService.queryParam());

        //     if (params) {
        //         url.addSearch(params);
        //     }

        //     return $http.get(url.toString());
        // },

        getAll () {
            return $q.resolve(VMAAS_PACKAGES_NOCVE);
        },

        getPackage(id) {
            let pkg;
            if (typeof id === 'string') {
                pkg = find(VMAAS_PACKAGES_NOCVE, {id: parseInt(id)});
            } else {
                pkg = find(VMAAS_PACKAGES_NOCVE, {id: id});
            }

            return $q.resolve(pkg);
        },

        getCVEs () {
            return $q.resolve(VMAAS_CVES);
        }
    };
}

apiModule.factory('Vulnerability', Vulnerability);
